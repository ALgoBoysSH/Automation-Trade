databaseChangeLog:
  - changeSet:
      id: 001-create-users
      author: codex
      changes:
        - createTable:
            tableName: users
            columns:
              - column: {name: id, type: BIGSERIAL, constraints: {primaryKey: true, nullable: false}}
              - column: {name: broker_user_id, type: VARCHAR(64), constraints: {nullable: false, unique: true}}
              - column: {name: name, type: VARCHAR(128), constraints: {nullable: false}}
              - column: {name: api_key, type: VARCHAR(128), constraints: {nullable: false}}
              - column: {name: encrypted_api_secret, type: VARCHAR(512), constraints: {nullable: false}}
              - column: {name: encrypted_access_token, type: VARCHAR(512), constraints: {nullable: false}}
              - column: {name: created_at, type: TIMESTAMP, constraints: {nullable: false}}

  - changeSet:
      id: 002-create-strategy-configs
      author: codex
      changes:
        - createTable:
            tableName: strategy_configs
            columns:
              - column: {name: id, type: BIGSERIAL, constraints: {primaryKey: true, nullable: false}}
              - column: {name: symbol, type: VARCHAR(32), constraints: {nullable: false}}
              - column: {name: capital, type: NUMERIC(12,2), constraints: {nullable: false}}
              - column: {name: risk_per_trade, type: NUMERIC(12,2), constraints: {nullable: false}}
              - column: {name: daily_loss_limit, type: NUMERIC(12,2), constraints: {nullable: false}}
              - column: {name: sl_points, type: INT, constraints: {nullable: false}}
              - column: {name: target_points, type: INT, constraints: {nullable: false}}
              - column: {name: enabled, type: BOOLEAN, constraints: {nullable: false}}
              - column: {name: created_at, type: TIMESTAMP, constraints: {nullable: false}}

  - changeSet:
      id: 003-create-trades
      author: codex
      changes:
        - createTable:
            tableName: trades
            columns:
              - column: {name: id, type: BIGSERIAL, constraints: {primaryKey: true, nullable: false}}
              - column: {name: symbol, type: VARCHAR(32), constraints: {nullable: false}}
              - column: {name: side, type: VARCHAR(16), constraints: {nullable: false}}
              - column: {name: status, type: VARCHAR(16), constraints: {nullable: false}}
              - column: {name: quantity, type: INT, constraints: {nullable: false}}
              - column: {name: entry_price, type: NUMERIC(12,2)}
              - column: {name: stop_loss_price, type: NUMERIC(12,2)}
              - column: {name: target_price, type: NUMERIC(12,2)}
              - column: {name: exit_price, type: NUMERIC(12,2)}
              - column: {name: realized_pnl, type: NUMERIC(12,2), defaultValueNumeric: 0}
              - column: {name: kite_order_id, type: VARCHAR(64)}
              - column: {name: created_at, type: TIMESTAMP, constraints: {nullable: false}}
              - column: {name: closed_at, type: TIMESTAMP}

  - changeSet:
      id: 004-create-daily-pnl
      author: codex
      changes:
        - createTable:
            tableName: daily_pnl
            columns:
              - column: {name: id, type: BIGSERIAL, constraints: {primaryKey: true, nullable: false}}
              - column: {name: trade_date, type: DATE, constraints: {nullable: false, unique: true}}
              - column: {name: gross_pnl, type: NUMERIC(12,2), constraints: {nullable: false}}
              - column: {name: net_pnl, type: NUMERIC(12,2), constraints: {nullable: false}}
              - column: {name: max_drawdown, type: NUMERIC(12,2), constraints: {nullable: false}}
              - column: {name: updated_at, type: TIMESTAMP, constraints: {nullable: false}}
